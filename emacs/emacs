;;=================================
;; 
;; @(#).emacs
;; Author: Zachary.Ma
;; Date: 25 Apr 2013
;; Discription: Zachary's emacs config file.
;;
;;=================================


;;=================================
;; Require load path
;;=================================
(add-to-list 'load-path (expand-file-name "~/.emacs.d/"))
(add-to-list 'load-path (expand-file-name "~/.emacs.d/plugins/"))

;;================================
;; Custom config
;;================================
(require 'global)

;;=================================
;; Color theme
;;=================================
(add-to-list 'load-path "~/.emacs.d/plugins/color-theme/")
(require 'color-theme)
(color-theme-initialize)
(color-theme-dark-blue2)

;;=================================
;; org-mod publish project
;;=================================
(setq org-hide-leading-stars t)
(setq org-log-done 'time)
(add-to-list 'load-path "~/.emacs.d/org-mod/")
(require 'orgpublish)

;;=================================
;; Template define
;;=================================
(require 'template)
(template-initialize)
(setq template-default-directories (cons "~/.emacs.d/templates/" template-default-directories))

;;=================================
;; Yasnippet config
;;=================================
(add-to-list 'load-path "~/.emacs.d/plugins/yasnippet/")
(require 'yasnippet)
(setq yas/prompt-functions 
      '(yas/dropdown-prompt yas/x-prompt yas/completing-prompt yas/ido-prompt yas/no-prompt))
(yas/global-mode 1)
(yas/minor-mode-on)

;;=================================
;; Auto complete
;;=================================
(add-to-list 'load-path "~/.emacs.d/plugins/auto-complete-1.3.1")
(require 'auto-complete)
(require 'auto-complete-config)
;; (add-to-list 'ac-dictionary-directories "~/.emacs.d/plugins/auto-complete-1.3.1/ac-dict")
(global-auto-complete-mode t)
;; (ac-config-default)

;;=================================
;; Yaml mode config
;;=================================
(require 'yaml-mode)
(add-to-list 'auto-mode-alist '("\\.yaml$" yaml-mode))

;;=================================
;; Python Mode
;;=================================
(add-to-list 'load-path "~/.emacs.d/plugins/python/")
(require 'python-mode)
(add-to-list 'auto-mode-alist '("\\.py\\'\\|\\.wsgi\\'" . python-mode))
(add-hook 'python-mode-hook(lambda ()
  (setq skeleton-pair-alist  
  '((?\" _ "\"" >)
   (?\' _ "\'" >)
   (?\( _ ")" >)
   (?\[ _ "]" >)
   (?\{ _ "}" >)))
  (setq skeleton-pair t)
  (global-set-key (kbd "(")  'skeleton-pair-insert-maybe)
  (global-set-key (kbd "{")  'skeleton-pair-insert-maybe)
  (global-set-key (kbd "\'") 'skeleton-pair-insert-maybe)
  (global-set-key (kbd "\"") 'skeleton-pair-insert-maybe)
  (global-set-key (kbd "[")  'skeleton-pair-insert-maybe) 
  (define-key py-mode-map (kbd "RET") 'newline-and-indent)
))

;;=================================
;; C mode config
;;=================================
(defun my-c-mode-auto-pair ()
  (interactive)
  (make-local-variable 'skeleton-pair-alist)
  (setq skeleton-pair-alist  '(
    (?' ?' _ "'")
    (?\( ? _ ")")
    (?\[ ? _ "]")
    (?{ \n > _ \n ?} >)))
  (setq skeleton-pair t)
  (local-set-key (kbd "(") 'skeleton-pair-insert-maybe)
  (local-set-key (kbd "{") 'skeleton-pair-insert-maybe)
  (local-set-key (kbd "'") 'skeleton-pair-insert-maybe)
  (local-set-key (kbd "[") 'skeleton-pair-insert-maybe))
(add-hook 'c-mode-hook 'my-c-mode-auto-pair)
(add-hook 'c++-mode-hook 'my-c-mode-auto-pair)

;;=================================
;; PHP mode config
;;=================================
(add-to-list 'load-path "~/.emacs.d/plugins/php-mode")
(require 'php-mode)
(require 'php-electric)
(setq c-basic-offset 8)
(setq-default indent-tabs-mode nil)
(add-hook 'php-mode-hook (lambda ()
    (defun ywb-php-lineup-arglist-intro (langelem)
      (save-excursion
        (goto-char (cdr langelem))
        (vector (+ (current-column) c-basic-offset))))
    (defun ywb-php-lineup-arglist-close (langelem)
      (save-excursion
        (goto-char (cdr langelem))
        (vector (current-column))))
    (c-set-offset 'arglist-intro 'ywb-php-lineup-arglist-intro)
    (c-set-offset 'arglist-close 'ywb-php-lineup-arglist-close)
    (define-abbrev php-mode-abbrev-table "ex" "extends")
    (php-electric-mode t)))

(require 'multi-web-mode)
(setq mweb-default-major-mode 'html-mode)
(setq mweb-tags '((php-mode "<\\?php\\|<\\? \\|<\\?=" "\\?>")
                  (js-mode "<script[^>]*>" "</script>")
                  (css-mode "<style[^>]*>" "</style>")))
(setq mweb-filename-extensions '("php" "htm" "html" "ctp" "phtml" "php4" "php5"))
(multi-web-global-mode 1)
